--------------------------------------------------------------------------------
### the initial condition files we would like to remap
--------------------------------------------------------------------------------

/project/projectdirs/ccsm1/inputdata/atm/cam/inic/fv/cami_1987-01-01_0.9x1.25_L26_c060703.nc

--------------------------------------------------------------------------------
### commands for putting PS on staggered grid
--------------------------------------------------------------------------------

### grid file names

/global/homes/w/whannah/HICCUP/files_grid/scrip_192x288.nc     # scalar / unstaggered grid
/global/homes/w/whannah/HICCUP/files_grid/scrip_191x288_US.nc  # U staggering
/global/homes/w/whannah/HICCUP/files_grid/scrip_192x288_VS.nc  # V staggering

### generate the grid files

ncremap -G ttl='Equi-Angular grid 192x288'#latlon=192,288#lat_typ=fv#lat_drc=s2n#lon_typ=grn_ctr  -g /global/homes/w/whannah/HICCUP/files_grid/scrip_192x288.nc
ncremap -G ttl='Equi-Angular grid 191x288'#latlon=191,288#lat_typ=uni#lat_drc=s2n#lon_typ=grn_ctr -g /global/homes/w/whannah/HICCUP/files_grid/scrip_191x288_US.nc
ncremap -G ttl='Equi-Angular grid 191x288'#latlon=192,288#lat_typ=fv#lat_drc=s2n#lon_typ=grn_wst  -g /global/homes/w/whannah/HICCUP/files_grid/scrip_192x288_VS.nc

### generate the mapping files

ncremap --src_grd=/global/homes/w/whannah/HICCUP/files_grid/scrip_192x288.nc --dst_grd=/global/homes/w/whannah/HICCUP/files_grid/scrip_191x288_US.nc -m /global/homes/w/whannah/HICCUP/files_mapping/map_192x288_to_191x288_US.nc
ncremap --src_grd=/global/homes/w/whannah/HICCUP/files_grid/scrip_192x288.nc --dst_grd=/global/homes/w/whannah/HICCUP/files_grid/scrip_192x288_VS.nc -m /global/homes/w/whannah/HICCUP/files_mapping/map_192x288_to_192x288_VS.nc

### remap the pressure variable

ncremap -v PS -m /global/homes/w/whannah/HICCUP/files_mapping/map_192x288_to_191x288_US.nc -i /project/projectdirs/ccsm1/inputdata/atm/cam/inic/fv/cami_1987-01-01_0.9x1.25_L26_c060703.nc -o /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_US.nc 
ncremap -v PS -m /global/homes/w/whannah/HICCUP/files_mapping/map_192x288_to_192x288_VS.nc -i /project/projectdirs/ccsm1/inputdata/atm/cam/inic/fv/cami_1987-01-01_0.9x1.25_L26_c060703.nc -o /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_VS.nc 

### fix coodinates

ncks -C -x -v w_stag,slat,slon /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_US.nc /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_US.nc  --ovr
ncks -C -x -v w_stag,slat,slon /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_VS.nc /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_VS.nc  --ovr

ncrename -d lat,slat -v lat,slat /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_US.nc 
ncrename -d lon,slon -v lon,slon /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_VS.nc 

--------------------------------------------------------------------------------
### extract variables for normal (scalar) grid
--------------------------------------------------------------------------------

ncks -x -v US,VS,w_stag,slat,slon /project/projectdirs/ccsm1/inputdata/atm/cam/inic/fv/cami_1987-01-01_0.9x1.25_L26_c060703.nc /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_no-wind.nc

--------------------------------------------------------------------------------
### extract variables for staggered grid
--------------------------------------------------------------------------------

ncks -v US /project/projectdirs/ccsm1/inputdata/atm/cam/inic/fv/cami_1987-01-01_0.9x1.25_L26_c060703.nc /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_US.nc
ncks -v VS /project/projectdirs/ccsm1/inputdata/atm/cam/inic/fv/cami_1987-01-01_0.9x1.25_L26_c060703.nc /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_VS.nc

--------------------------------------------------------------------------------
### rename the un-staggered pressure in the wind file and append staggered version
### (just removing PS doesnt work)
--------------------------------------------------------------------------------

ncrename -v PS,PS_unstaggered /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_US.nc
ncrename -v PS,PS_unstaggered /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_VS.nc

ncks -A /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_US.nc /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_US.nc 
ncks -A /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_PS_VS.nc /global/cscratch1/sd/whannah/HICCUP/data/cami_1987-01-01_0.9x1.25_L26_c060703_VS.nc

--------------------------------------------------------------------------------
### append the vertically remapped files
--------------------------------------------------------------------------------

VGRID=72; FILE=/global/cscratch1/sd/whannah/HICCUP/data/HICCUP.cami_1987-01-01_0.9x1.25_L${VGRID}_20210125;cp ${FILE}_no-wind.nc ${FILE}.nc;ncks -A ${FILE}_VS.nc ${FILE}.nc;ncks -A ${FILE}_US.nc ${FILE}.nc

VGRID=38; cp /global/cscratch1/sd/whannah/HICCUP/data/HICCUP.cami_1987-01-01_0.9x1.25_L${VGRID}_20210125_no-wind.nc /global/cscratch1/sd/whannah/HICCUP/data/HICCUP.cami_1987-01-01_0.9x1.25_L${VGRID}_20210125.nc
VGRID=38; ncks -A /global/cscratch1/sd/whannah/HICCUP/data/HICCUP.cami_1987-01-01_0.9x1.25_L${VGRID}_20210125_US.nc /global/cscratch1/sd/whannah/HICCUP/data/HICCUP.cami_1987-01-01_0.9x1.25_L${VGRID}_20210125.nc
VGRID=38; ncks -A /global/cscratch1/sd/whannah/HICCUP/data/HICCUP.cami_1987-01-01_0.9x1.25_L${VGRID}_20210125_VS.nc /global/cscratch1/sd/whannah/HICCUP/data/HICCUP.cami_1987-01-01_0.9x1.25_L${VGRID}_20210125.nc

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
